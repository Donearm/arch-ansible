- name: Set timezone
  timezone:
    name: "{{ global_timezone }}"
    hwclock: UTC

- name: Generate locale
  locale_gen:
    name: "{{ global_locale }}"

- name: Set locale
  shell: set -o pipefail || exit 1;
    { localectl status &&
      localectl set-locale {{ global_locale }} &&
      localectl status
    ;} | sort | uniq -u
  register: locale_changed
  changed_when: locale_changed.stdout != ""

- name: Set keymap
  shell: set -o pipefail || exit 1;
    { localectl status &&
      localectl set-keymap {{ global_keymap }} &&
      localectl status
    ;} | sort | uniq -u
  register: keymap_changed
  changed_when: keymap_changed.stdout != ""
